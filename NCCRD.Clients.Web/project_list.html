<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <script src="js/conditional_include_mdbootstrap_headers.js"></script>
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/knockout-3.4.2.js"></script>
    <!--<script src="js/conditional_include_knockout.js"></script>-->
    <script src="js/conditional_include_mdbootstrap.js"></script>
    <script src="js/shared.js"></script>
    <script src="js/project_list.js"></script>

    <!--Region-Tree-->
    <link href="css/gijgo/modular/core.css" rel="stylesheet" />
    <link href="css/gijgo/modular/tree.css" rel="stylesheet" />
    <script src="js/gijgo/modular/core.js"></script>
    <script src="js/gijgo/modular/tree.js"></script>
</head>

<body>

    <hr />

    <!--Filters-->
    <div class="row">
        <div class="col-md-3">
            <button class="btn btn-primary" id="toggleGeneral" style="width:100%;margin:0px 0px 0px 0px" type="button" data-toggle="collapse" data-target="#generalCollapse" aria-expanded="false" aria-controls="generalCollapse" onclick="ToggleToggleText(this)">
                Show general filters
            </button>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary" id="toggleRegion" style="width:100%;margin:0px 0px 0px 0px" type="button" data-toggle="collapse" data-target="#regionCollapse" aria-expanded="false" aria-controls="regionCollapse" onclick="ToggleToggleText(this)">
                Show region filter
            </button>
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary" id="toggleSector" style="width:100%;margin:0px 0px 0px 0px" type="button" data-toggle="collapse" data-target="#sectorCollapse" aria-expanded="false" aria-controls="sectorCollapse" onclick="ToggleToggleText(this)">
                Show sector filter
            </button>
        </div>
        <div class="col-md-3">
            <button class="btn btn-success" style="width:100%;margin:0px 0px 0px 0px" onclick="FilterProjects()">
                Filter projects
            </button>
        </div>
    </div>

    <div class="collapse" id="generalCollapse">
        <hr />
        <div class="row">
            <div class="col-md-12">
                <h4>General filters:</h4>
            </div>
        </div>
        <div class="row">

            <div class="col-md-4" id="filterTitle">
                <label>Title:</label>
                <input id="titleFilter" type="text" style="margin-top:5px" onkeyup="TitleFilterChanged(this.value)" />
            </div>

            <div class="col-md-4" id="filterStatus">
                <label>Status:</label>
                <br />
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" style="width:100%;margin:0px 0px 0px 0px" type="button" id="ddStatus" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        All
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="projectStatusBindObject" data-bind="foreach: projectStatus">
                        <button class="dropdown-item" data-bind="attr: {id: ProjectStatusId}, text: Value" onclick="StatusFilterSelected(this)"></button>
                    </div>
                </div>
            </div>

            <div class="col-md-4" id="filterTypology">
                <label>Typology:</label>
                <br />
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" style="width:100%;margin:0px 0px 0px 0px" type="button" id="ddTypology" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        All
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="typologyBindObject" data-bind="foreach: typology">
                        <a class="dropdown-item" data-bind="attr: {id: TypologyID}, text: Value" onclick="TypologyFilterSelected(this)"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="collapse" id="regionCollapse">
        <hr />
        <div class="row">
            <div class="col-md-9">
                <p style="font-size:x-large">
                    <span>Region filter: </span>
                    <span id="regionFilterText">All</span>
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <button id="btnRegionTreeExpandAll" class="btn btn-secondary" style="width:200px;margin:0px 0px 0px 0px">Expand all</button>
                <button id="btnRegionTreeCollapseAll" class="btn btn-secondary" style="width:200px;margin:0px 0px 0px 0px">Collapse all</button>
            </div>
        </div>
        <br />
        <div class="row">
            <div class="col-md-12" id="regionTree"></div>
        </div>

    </div>

    <div class="collapse" id="sectorCollapse">
        <hr />
        <div class="row">
            <div class="col-md-9">
                <p style="font-size:x-large">
                    <span>Sector filter: </span>
                    <span id="sectorFilterText">All</span>
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <button id="btnSectorTreeExpandAll" class="btn btn-secondary" style="width:200px;margin:0px 0px 0px 0px">Expand all</button>
                <button id="btnSectorTreeCollapseAll" class="btn btn-secondary" style="width:200px;margin:0px 0px 0px 0px">Collapse all</button>
            </div>
        </div>
        <br />
        <div class="row">
            <div class="col-md-12" id="sectorTree"></div>
        </div>
    </div>

    <hr />
    <br />

    <div id="projectListBindObject">
        <!-- Project List -->
        <div data-bind="foreach: projects">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title" data-bind="text: ProjectTitle"></h4>
                    <p class="card-text" data-bind="text: ProjectDescription"></p>
                    <button data-bind="attr: { id: ProjectId}" class="btn btn-primary" data-toggle="modal" data-target="#projectDetailsModal" onclick="load_details(this.id)">View details</button>
                </div>
            </div>
            <br />
        </div>
    </div>

    <!-- Details Modal -->
    <div class="modal fade bottom" id="projectDetailsModal">
        <div class="modal-dialog modal-fluid" style="width:85%;margin:auto">
            <div class="modal-content">
                <div class="modal-body">
                    <div id="project_details">
                        <!-- Content will be loaded dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>

        //Fetch region tree data and setup event handlers
        fetch(apiBaseURL + 'api/region/GetAllTree')
            .then((resp) => resp.json()) // Transform the data into json
            .then(function (data) {
                $('#regionTree').tree(data);
                var tree = $('#regionTree').tree();

                tree.on('select', function (e, node, id) {
                    let nodeData = tree.getDataById(id);
                    regionId = nodeData.id;
                    $("#regionFilterText").text(nodeData.text);
                });

                tree.on('unselect', function (e, node, id) {
                    regionId = 0;
                    $("#regionFilterText").text("All");
                });

                $("#btnRegionTreeExpandAll").click(function () {
                    tree.expandAll();
                });

                $("#btnRegionTreeCollapseAll").click(function () {
                    tree.collapseAll();
                });
            });

        //Fetch sector tree data and setup event handlers
        fetch(apiBaseURL + 'api/sector/GetAllTree')
            .then((resp) => resp.json()) // Transform the data into json
            .then(function (data) {
                $('#sectorTree').tree(data);
                var tree = $('#sectorTree').tree();

                tree.on('select', function (e, node, id) {
                    let nodeData = tree.getDataById(id);
                    sectorId = nodeData.id;
                    $("#sectorFilterText").text(nodeData.text);
                });

                tree.on('unselect', function (e, node, id) {
                    sectorId = 0;
                    $("#sectorFilterText").text("All");
                });

                $("#btnSectorTreeExpandAll").click(function () {
                    tree.expandAll();
                });

                $("#btnSectorTreeCollapseAll").click(function () {
                    tree.collapseAll();
                });
            });

    </script>

</body>

</html>
